<Page x:Class="Chefs.Views.CookbookDetailPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="using:Chefs.Views"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:models="using:Chefs.Business.Models"
      xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
      xmlns:not_mobile="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:toolkit="using:Uno.UI.Toolkit"
      xmlns:uen="using:Uno.Extensions.Navigation.UI"
      xmlns:uer="using:Uno.Extensions.Reactive.UI"
      xmlns:um="using:Uno.Material"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:win="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
      NavigationCacheMode="Enabled"
      mc:Ignorable="d">

    <utu:AutoLayout Background="{ThemeResource BackgroundBrush}">
        <utu:AutoLayout.Resources>
            <muxc:UniformGridLayout x:Key="NarrowGridLayout"
                                    ItemsStretch="Fill"
                                    MaximumRowsOrColumns="2"
                                    MinColumnSpacing="10"
                                    MinItemWidth="155"
                                    MinRowSpacing="10" />
            <muxc:UniformGridLayout x:Key="WideGridLayout"
                                    ItemsStretch="Fill"
                                    MaximumRowsOrColumns="5"
                                    MinColumnSpacing="30"
                                    MinItemWidth="200"
                                    MinRowSpacing="30" />
            <x:String x:Key="Icon_Arrow_Back">F1 M 16 7 L 3.8299999237060547 7 L 9.420000076293945 1.4099998474121094 L 8 0 L 0 8 L 8 16 L 9.40999984741211 14.59000015258789 L 3.8299999237060547 9 L 16 9 L 16 7 Z</x:String>
            <x:String x:Key="Icon_Tune">F1 M 0 10.5 L 0 12 L 4.5 12 L 4.5 10.5 L 0 10.5 Z M 0 1.5 L 0 3 L 7.5 3 L 7.5 1.5 L 0 1.5 Z M 7.5 13.5 L 7.5 12 L 13.5 12 L 13.5 10.5 L 7.5 10.5 L 7.5 9 L 6 9 L 6 13.5 L 7.5 13.5 Z M 3 4.5 L 3 6 L 0 6 L 0 7.5 L 3 7.5 L 3 9 L 4.5 9 L 4.5 4.5 L 3 4.5 Z M 13.5 7.5 L 13.5 6 L 6 6 L 6 7.5 L 13.5 7.5 Z M 9 4.5 L 10.5 4.5 L 10.5 3 L 13.5 3 L 13.5 1.5 L 10.5 1.5 L 10.5 0 L 9 0 L 9 4.5 Z</x:String>
            <x:String x:Key="Icon_More_Vert">F1 M 2 4 C 3.100000023841858 4 4 3.100000023841858 4 2 C 4 0.8999999761581421 3.100000023841858 0 2 0 C 0.8999999761581421 0 0 0.8999999761581421 0 2 C 0 3.100000023841858 0.8999999761581421 4 2 4 Z M 2 6 C 0.8999999761581421 6 0 6.899999976158142 0 8 C 0 9.100000023841858 0.8999999761581421 10 2 10 C 3.100000023841858 10 4 9.100000023841858 4 8 C 4 6.899999976158142 3.100000023841858 6 2 6 Z M 2 12 C 0.8999999761581421 12 0 12.899999976158142 0 14 C 0 15.100000023841858 0.8999999761581421 16 2 16 C 3.100000023841858 16 4 15.100000023841858 4 14 C 4 12.899999976158142 3.100000023841858 12 2 12 Z</x:String>
            <x:String x:Key="Icon_Add">F1 M 16 9.142857142857142 L 9.142857142857142 9.142857142857142 L 9.142857142857142 16 L 6.857142857142857 16 L 6.857142857142857 9.142857142857142 L 0 9.142857142857142 L 0 6.857142857142857 L 6.857142857142857 6.857142857142857 L 6.857142857142857 0 L 9.142857142857142 0 L 9.142857142857142 6.857142857142857 L 16 6.857142857142857 L 16 9.142857142857142 Z</x:String>
            <DataTemplate x:Key="RecipeTemplate"
                          x:DataType="models:Recipe">
                <!-- Using an x:bind for windows as a workaround for now regarding this WinUI issue: -->
                <!-- https://github.com/unoplatform/uno.chefs/issues/144#issuecomment-1400665013 -->
                <Border win:DataContext="{x:Bind}">
                    <utu:CardContentControl x:Name="RecipeTemplateCard"
                                            MaxWidth="400"
                                            Background="{ThemeResource SurfaceBrush}"
                                            CornerRadius="4"
                                            Style="{StaticResource FilledCardContentControlStyle}">
                        <utu:CardContentControl.ContentTemplate>
                            <DataTemplate>
                                <utu:AutoLayout CornerRadius="4">
                                    <Border x:Name="ImageLayout"
                                            Height="144">
                                        <Image HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Source="{Binding ImageUrl}"
                                               Stretch="UniformToFill" />
                                    </Border>
                                    <utu:AutoLayout Padding="16"
                                                    PrimaryAxisAlignment="Center"
                                                    Spacing="4">

                                        <TextBlock Foreground="{ThemeResource OnSurfaceBrush}"
                                                   Style="{StaticResource TitleSmall}"
                                                   Text="{Binding Name}"
                                                   TextWrapping="Wrap" />
                                        <TextBlock Foreground="{ThemeResource OnSurfaceLowBrush}"
                                                   Style="{StaticResource CaptionMedium}"
                                                   Text="{Binding TimeCal}"
                                                   TextWrapping="Wrap" />
                                    </utu:AutoLayout>
                                </utu:AutoLayout>
                            </DataTemplate>
                        </utu:CardContentControl.ContentTemplate>
                    </utu:CardContentControl>
                </Border>
            </DataTemplate>
        </utu:AutoLayout.Resources>
        <utu:AutoLayout utu:AutoLayout.PrimaryAlignment="Stretch">
            <utu:NavigationBar Background="{ThemeResource SurfaceInverseBrush}"
                               Content="{Binding Cookbook.Name}"
                               Style="{StaticResource PrimaryModalNavigationBarStyle}">
                <utu:NavigationBar.MainCommand>
                    <AppBarButton>
                        <not_mobile:AppBarButton.Icon>
                            <SymbolIcon Symbol="Back" />
                        </not_mobile:AppBarButton.Icon>
                    </AppBarButton>
                </utu:NavigationBar.MainCommand>
                <utu:NavigationBar.PrimaryCommands>
                    <AppBarButton>
                        <AppBarButton.Icon>
                            <BitmapIcon Foreground="{ThemeResource OnPrimaryBrush}"
                                        UriSource="ms-appx:///Chefs/Assets/Icons/three_dot.png" />
                        </AppBarButton.Icon>
                    </AppBarButton>
                </utu:NavigationBar.PrimaryCommands>
            </utu:NavigationBar>
            <uer:FeedView Source="{Binding Cookbook}">
                <DataTemplate>
                    <!-- It is necessary to disable the HorizontalScrollMode because of this issue: https://github.com/unoplatform/uno/issues/12871 -->
                    <ScrollViewer x:Name="RecipesScrollViewer"
                                  Padding="16"
                                  utu:AutoLayout.PrimaryAlignment="Stretch"
                                  HorizontalScrollMode="Disabled"
                                  VerticalScrollBarVisibility="Hidden">
                        <utu:AutoLayout>
                            <utu:AutoLayout Padding="0,0,0,16"
                                            Justify="SpaceBetween"
                                            Orientation="Horizontal">
                                <TextBlock utu:AutoLayout.CounterAlignment="Center"
                                           Style="{StaticResource BodyLarge}">
                                    <Run Text="{Binding Data.Recipes.Count}" />
                                    <Run Text="results" />
                                </TextBlock>
                                <Button utu:AutoLayout.CounterAlignment="Center"
                                        Content="Filters"
                                        Style="{StaticResource TextButtonStyle}">
                                    <um:ControlExtensions.Icon>
                                        <PathIcon Data="{StaticResource Icon_Tune}" />
                                    </um:ControlExtensions.Icon>
                                </Button>
                            </utu:AutoLayout>
                            <utu:AutoLayout Padding="0,16">

                                <muxc:ItemsRepeater uen:Navigation.Request="SavedRecipeDetails"
                                                    ItemTemplate="{StaticResource RecipeTemplate}"
                                                    ItemsSource="{Binding Data.Recipes}">
                                    <muxc:ItemsRepeater.Layout>
                                        <muxc:UniformGridLayout ItemsStretch="Fill"
                                                                MaximumRowsOrColumns="2"
                                                                MinColumnSpacing="8"
                                                                MinItemWidth="130"
                                                                MinRowSpacing="8" />
                                    </muxc:ItemsRepeater.Layout>
                                </muxc:ItemsRepeater>

                            </utu:AutoLayout>
                        </utu:AutoLayout>
                    </ScrollViewer>
                </DataTemplate>
            </uer:FeedView>
        </utu:AutoLayout>
        <Button x:Name="FabButton"
                Margin="13,10"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                uen:Navigation.Data="{Binding Cookbook.Value, Mode=TwoWay}"
                uen:Navigation.Request="CreateUpdateCookbook"
                utu:AutoLayout.IsIndependentLayout="True"
                CornerRadius="60"
                Style="{StaticResource FabStyle}">
            <um:ControlExtensions.Icon>
                <PathIcon Data="{StaticResource Icon_Add}"
                          Foreground="{ThemeResource SurfaceBrush}" />
            </um:ControlExtensions.Icon>
        </Button>
    </utu:AutoLayout>
</Page>
