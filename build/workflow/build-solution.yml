jobs:
- job: Build_Solution
  pool:
    vmImage: windows-2022
  
  steps:
  - checkout: self
    fetchDepth: 0
    clean: 'true'

  - template: templates/dotnet6-install-windows.yml
  - template: templates/canary-updater.yml
  - template: templates/gitversion.yml

   # This SDK version is needed as long as `uap10.0` will be supported in Uno.Core
  - powershell: .\build\Install-WindowsSdkISO.ps1 18362
    displayName: Install Windows SDK 18362

  - task: MSBuild@1
    displayName: 'Build solution'
    retryCountOnTaskFailure: 3
    inputs:
      solution: src/Chefs.sln
      configuration: Release
      msbuildLocationMethod: version
      msbuildVersion: latest
      maximumCpuCount: true
      msbuildArguments: /m /r "/p:InformationalVersion=%GITVERSION_InformationalVersion%" /detailedsummary /bl:$(build.artifactstagingdirectory)\build-solution.binlog

  - task: PublishBuildArtifacts@1
    condition: always()
    inputs:
      PathtoPublish: $(build.artifactstagingdirectory)
      ArtifactName: Solution
      ArtifactType: Container
