jobs:
- job: Android
  pool:
    vmImage: windows-2022

  variables:
  - group: 'UnoPlatform KeyStore'

  steps:
  - template: templates/gitversion.yml
  - template: templates/dotnet6-install-windows.yml
  - template: templates/canary-updater.yml

  - task: DownloadSecureFile@1
    name: keyStore
    displayName: "Download keystore from secure files"
    inputs:
      secureFile: unoplatform.jks

  - task: UseDotNet@2
    condition: eq(variables['IsCanaryBranch'], true)
    retryCountOnTaskFailure: 3
    inputs:
      packageType: runtime
      version: 3.1.3

  - script: |
      cd $(build.sourcesdirectory)/src/Chefs.Mobile
      dotnet publish -f:net6.0-android -c:Release "/p:InformationalVersion=%GITVERSION_InformationalVersion%" /p:AndroidSigningKeyStore=$(keyStore.secureFilePath) /p:AndroidSigningStorePass=$(AndroidSigningStorePass) /p:AndroidSigningKeyPass=$(AndroidSigningKeyPass) /p:AndroidSigningKeyAlias=$(AndroidSigningKeyAlias) /p:AndroidKeyStore=true /bl:$(build.artifactstagingdirectory)/build-android.binlog 
    displayName: 'Build Android (net6)'

  - task: PublishBuildArtifacts@1
    condition: always()
    inputs:
      PathtoPublish: $(build.artifactstagingdirectory)
      ArtifactName: Android
      ArtifactType: Container