steps:
  - checkout: self
    fetchDepth: 0
    persistCredentials: true

  - task: UseDotNet@2
    retryCountOnTaskFailure: 3
    displayName: 'Use .Net Core runtime 6.0.0'
    inputs:
      packageType: runtime
      version: 6.0.0

  # Restore nuget.org to the list of existing sources, .NET 6 Pre 2 may somehow remove it
  - powershell: |
      dotnet nuget add source https://api.nuget.org/v3/index.json -n nuget.org | Out-Null
      $global:LASTEXITCODE = 0
    displayName: Adjust nuget.org source 

  - task: gitversion/setup@0
    inputs:
      versionSpec: '5.x'

  - task: gitversion/execute@0
    inputs:
      updateAssemblyInfo: 'False'
      useConfigFile: true
      configFilePath: build/gitversion.yml
    displayName: Use GitVersion

  - template: set-app-versions.yml